<odoo>
    <data>
        <record id="meal_order_form_view" model="ir.ui.view">
            <field name="name">meal.order.form.view</field>
            <field name="model">meal.order</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button string='confirm' type="object" name='action_confirm' class="btn-primary" invisible="state!='draft'"/>
                        <button string= 'in_process' type="object" name='action_in_process' class="btn-warning" invisible="state!='confirmed'"/>
                        <button string= 'delivered' type="object" name='action_delivered' class="btn-success" invisible="state!='in_process'"/>
                        <button string= 'cancelled' type="object" name='action_cancelled' class="btn-danger" invisible="state=='delivered'"/>
                        <button type='action' name='%(tech_order1.external_item_wizard_window_action)d' 
                        string="Add External Item" class='btn-primary' invisible="state!='draft'" ></button>
                        <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,in_process,delivered"></field>
                    </header>
                    <sheet>
                        <!-- <div class="oe_button_box" name="button_box">
                            <button type='action' name='%(tech_order1.external_item_wizard_window_action)d' string="Add External Item" class='btn-info'></button>
                        </div> -->
                        <h1>
                            <field name="name" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"
                                required="state=='draft'"
                            ></field>
                        </h1>
                        <group>
                            <group>
                                <field name="customer_id" required="order_type=='external'"
                                 readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="order_type" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="table_number" invisible="order_type!='internal'" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="order_tag_ids" widget="many2many_tags" options="{'color_field':'color', 'no_create': True}" readonly="state in ('delivered','cancelled')"></field>
                            </group>
                            <notebook>
                                <page name="items" string="Items">
                                    <field name="item_ids" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')">
                                        <tree> <!--editable = "top" restrict the pop up-->
                                            <field name="meal_id"></field>
                                            <field name="quantity"></field>
                                            <field name="price"></field>
                                            <field name="total_price"></field>
                                            <field name="state" widget='badge'
                                                decoration-success="state == 'delivered'"
                                                decoration-warning="state == 'in_process'"
                                                decoration-info="state =='confirmed'"
                                                decoration-danger="state=='cancelled'"
                                                decoration-muted="state=='draft'">
                                            </field>
                                        </tree>
                                        <form>
                                            <sheet>
                                                <group>
                                                    <field name="meal_id"></field>
                                                    <field name="quantity"></field>
                                                </group>
                                                <group>
                                                    <field name="price" readonly='True'></field>
                                                    <field name="total_price" readonly='True'></field>
                                                </group>
                                            </sheet>
                                        </form>
                                    </field>
                                </page>
                                <page name='external_items' string='External items'>
                                    <field name="external_item_ids">
                                        <tree>
                                            <field name="product_id"></field>
                                        </tree>
                                    </field>
                                </page>
                            </notebook>
                            
                            <group>
                                <field name="order_date" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="total_price" readonly="True"></field>
                                <field name="expected_duration" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="expected_date" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                <field name="is_urgent" readonly="state in ('in_process', 'delivered','cancelled')"></field>
                                <field name="active"></field>
                            </group>
                            <group>
                                <group>
                                    <field name="note" readonly="state in ('confirmed', 'in_process', 'delivered','cancelled')"></field>
                                </group>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="meal_order_tree_view" model="ir.ui.view">
            <field name="name">meal.order.tree.view</field>
            <field name="model">meal.order</field>
            <field name="arch" type="xml">
                <tree
                        decoration-success="state == 'delivered'"
                        decoration-warning="state =='in_process'"
                        decoration-info="state =='confirmed'"
                        decoration-danger="state=='cancelled'"
                        decoration-muted="state=='draft'"
                >
                    <field name="name"></field>
                    <field name="customer_id"></field>
                    <field name="order_type"></field>
                    <field name="table_number" invisible="order_type!='internal'"></field>
                    <field name="order_date"></field>
                    <field name="total_price" optional="hide"></field>
                    <field name="expected_date"></field>
                    <field name="expected_duration"></field>
                    <field name="is_urgent" optional='show'></field>
                    <field name="note"></field>
                    <field name="state" optional='show' widget='badge'
                        decoration-success="state == 'delivered'"
                        decoration-warning="state == 'in_process'"
                        decoration-info="state =='confirmed'"
                        decoration-danger="state=='cancelled'"
                        decoration-muted="state=='draft'"
                    >
                    </field>
                </tree>
            </field>
        </record>
        <!--search view  (search, filter, group by)-->
        <record id="meal_order_view_search" model="ir.ui.view">
            <field name="name">meal.order.search.view</field>
            <field name="model">meal.order</field>
            <field name="arch" type="xml">
                <search>
                    <field name="customer_id" string="Customer"></field>
                    <field name="name" string="Name"></field>
                    <field name="order_date" string="Order Date"></field>
                    <field name="order_type" string="Order Type"></field>
                    <field name="total_price" string = "Total Price"></field>
                    <separator/>
                    <filter string="Internal" name="type_internal" domain="[('order_type', '=', 'internal')]" />
                    <filter string="External" name="type_external" domain="[('order_type', '=', 'external')]" />
                    <separator/>
                    <filter name="urgent_order" string="Urgent Order" domain="[('is_urgent', '=', 'True')]" />
                    <separator/>
                    <filter name="Today_Order" string="Today_Order" domain="[('order_date', '=', time.strftime('%Y-%m-%d'))]" />
                    <group name="group_by" string="Group By">
                        <filter name="order_type" string="Order Type" context="{'group_by': 'order_type'}"/> 
                        <filter name="order_date" string="Order Date" context="{'group_by': 'order_date'}"/>
                        <filter name="customer_id" string="Customer" context="{'group_by': 'customer_id'}"/>                     
                    </group>
                </search>
            </field>
        </record>
        <record id="meal_order_window_action" model="ir.actions.act_window">
            <field name="name">Meal Order</field>
            <field name="res_model">meal.order</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem
            id="meal_order_menu"
            name="Order"
            action="meal_order_window_action"
            parent="tech_order1.order_base_menu"
            sequence= "10"/>
        
    
    </data>
    
</odoo>